{% extends 'users/base_storekeeper.html' %}

{% block title %}Storekeeper Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Welcome -->
  <div class="mb-4">
    <h2>Welcome, {{ request.user.username }}</h2>
  </div>

  <!-- Summary Cards -->
  <div class="row mb-4 g-3">
    <div class="col-md-4">
      <div class="card text-white bg-primary h-100">
        <div class="card-body">
          <h5 class="card-title">Total Products</h5>
          <p class="card-text">{{ total_products }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-warning h-100">
        <div class="card-body">
          <h5 class="card-title">Total Stock</h5>
          <p class="card-text">{{ total_stock }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-danger h-100">
        <div class="card-body">
          <h5 class="card-title">Low Stock Alerts</h5>
          <p class="card-text">{{ low_stock_count }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Stock Operations -->
  <div class="mb-4">
    <a href="{% url 'receive_stock' %}" class="btn btn-success me-2">Receive Stock</a>
    <a href="{% url 'record_sale' %}" class="btn btn-danger me-2">Record Sale</a>
    <a href="{% url 'add_product' %}" class="btn btn-primary">Add Product</a>
    <a href="{% url 'move_stock' %}" class="btn btn-warning">Move Stock</a>


  </div>

  <!-- Products Table -->
  <div class="mb-5">
    <h4>Products</h4>
    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered">
        <thead class="table-success">
          <tr>
            <th>Name</th>
            <th>SKU</th>
            <th>Category</th>
            <th>Cost Price</th>
            <th>Selling Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.sku }}</td>
            <td>{{ product.category.name }}</td>
            <td>{{ product.cost_price }}</td>
            <td>{{ product.selling_price }}</td>
            <td>
              <a href="{% url 'edit_product' product.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form action="{% url 'delete_product' product.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center">No products available</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Inventory Table -->
  <div class="mb-5">
    <h4>Inventory Overview</h4>
    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered">
        <thead class="table-info">
          <tr>
            <th>Product</th>
            <th>Warehouse</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for item in inventory %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.warehouse.name }}</td>
            <td>{{ item.quantity }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="text-center">No inventory records available</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Stock Movements -->
  <div class="mb-5">
    <h4>Recent Stock Movements</h4>
    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered">
        <thead class="table-secondary">
          <tr>
            <th>Product</th>
            <th>Warehouse</th>
            <th>Quantity</th>
            <th>Type</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for movement in recent_stock %}
          <tr>
            <td>{{ movement.product.name }}</td>
            <td>{{ movement.warehouse.name }}</td>
            <td>{{ movement.quantity }}</td>
            <td>{{ movement.get_movement_type_display }}</td>
            <td>{{ movement.created_at|date:"Y-m-d H:i" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center">No stock movements yet</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
